---
/**
 * ProjectHero component - visual hero section for project detail pages
 * Displays project image (or gradient fallback), title, description, metadata, and actions
 */
import Icon from './Icon.astro';
import Button from './Button.astro';
import { getDisplayTags } from '../consts';

interface Props {
  title: string;
  description: string;
  image?: string;
  status: 'released' | 'in-progress';
  pubDate: Date;
  repository?: string;
  tags?: string[];
}

const { title, description, image, status, pubDate, repository, tags } = Astro.props;

const formattedDate = pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const displayTags = getDisplayTags(tags);
---

<section class="relative overflow-hidden bg-gradient-to-br from-off-white via-white to-off-white dark:from-near-black dark:via-near-black dark:to-near-black">
  {/* Background: Image with overlay OR decorative pattern */}
  {
    image ? (
      <div class="absolute inset-0">
        <img
          src={image}
          alt=""
          class="w-full h-full object-cover"
          loading="eager"
          decoding="async"
          fetchpriority="high"
        />
        <div class="absolute inset-0 bg-gradient-to-t from-near-black/90 via-near-black/60 to-near-black/30" />
      </div>
    ) : (
      <div class="absolute inset-0 overflow-hidden pointer-events-none" aria-hidden="true">
        {/* Grid pattern overlay */}
        <div class="absolute inset-0 bg-[linear-gradient(rgba(107,142,35,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(107,142,35,0.03)_1px,transparent_1px)] dark:bg-[linear-gradient(rgba(107,142,35,0.08)_1px,transparent_1px),linear-gradient(90deg,rgba(107,142,35,0.08)_1px,transparent_1px)] bg-[size:60px_60px]" />

        {/* Gradient orbs */}
        <div class="absolute top-1/4 -left-32 w-64 h-64 bg-forest-green/5 dark:bg-forest-green/10 rounded-full blur-3xl" />
        <div class="absolute bottom-1/4 -right-32 w-80 h-80 bg-olive-drab/5 dark:bg-olive-drab/10 rounded-full blur-3xl" />

        {/* Decorative code elements */}
        <div class="absolute top-12 right-12 text-olive-drab/10 dark:text-olive-drab/20 text-4xl font-mono hidden lg:block">
          &lt;/&gt;
        </div>
      </div>
    )
  }

  {/* Content */}
  <div class="relative z-10 max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-20">
    {/* Back link */}
    <a
      href="/projects"
      class:list={[
        'inline-flex items-center gap-2 mb-8 text-sm font-medium transition-colors',
        image
          ? 'text-white/80 hover:text-white'
          : 'text-olive-drab hover:text-dark-olive dark:hover:text-white',
      ]}
    >
      <Icon name="arrow-left" size="sm" />
      Back to Projects
    </a>

    {/* Status badge */}
    {
      status === 'in-progress' && (
        <div class="mb-4">
          <span
            class:list={[
              'inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-full',
              image
                ? 'bg-white/20 text-white backdrop-blur-sm'
                : 'bg-olive-drab/10 text-olive-drab',
            ]}
          >
            <Icon name="clock" class="w-3.5 h-3.5" />
            In Progress
          </span>
        </div>
      )
    }

    {/* Title */}
    <h1
      class:list={[
        'text-4xl sm:text-5xl lg:text-6xl font-bold mb-4 tracking-tight',
        image ? 'text-white' : 'text-dark-olive dark:text-off-white',
      ]}
    >
      {title}
    </h1>

    {/* Description */}
    <p
      class:list={[
        'text-lg sm:text-xl max-w-2xl mb-6 leading-relaxed',
        image ? 'text-white/90' : 'text-near-black/80 dark:text-off-white/80',
      ]}
    >
      {description}
    </p>

    {/* Date */}
    <div
      class:list={[
        'flex items-center gap-2 text-sm mb-6',
        image ? 'text-white/70' : 'text-olive-drab',
      ]}
    >
      <Icon name="calendar" size="sm" />
      <time datetime={pubDate.toISOString()}>{formattedDate}</time>
    </div>

    {/* Tech tags */}
    {
      displayTags.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-8">
          {displayTags.map((tag) => (
            <span
              class:list={[
                'text-xs font-medium px-3 py-1.5 rounded-full border',
                image
                  ? 'bg-white/10 text-white border-white/20 backdrop-blur-sm'
                  : 'bg-off-white dark:bg-white/10 text-dark-olive/80 dark:text-off-white/80 border-olive-drab/10 dark:border-olive-drab/20',
              ]}
            >
              {tag}
            </span>
          ))}
        </div>
      )
    }

    {/* Action buttons */}
    {
      repository && (
        <div class="flex flex-wrap gap-4">
          <Button href={repository} variant="primary" icon="github">
            View Repository
          </Button>
        </div>
      )
    }
  </div>
</section>
