---
/**
 * ProjectCard component for displaying project entries
 * Enhanced with hover effects and improved visual styling
 */
import type { CollectionEntry } from 'astro:content';
import Icon from './Icon.astro';
import { getDisplayTags } from '../consts';

interface Props {
  project: CollectionEntry<'projects'>;
  featured?: boolean;
  /** When true, image loads eagerly (use for above-fold LCP optimization) */
  priority?: boolean;
}

const { project, featured = false, priority = false } = Astro.props;
const { title, description, pubDate, repository, image, tags, status } = project.data;

const formattedDate = pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const displayTags = getDisplayTags(tags);
---

<article
  class="group relative bg-white dark:bg-near-black rounded-xl border border-olive-drab/10 dark:border-olive-drab/20 overflow-hidden shadow-sm hover:shadow-lg hover:shadow-forest-green/10 hover:border-forest-green/20 dark:hover:border-forest-green/40 transform hover:-translate-y-1 transition-all duration-300"
>
  {
    image ? (
      <a href={`/projects/${project.id}`} class="block overflow-hidden">
        <img
          src={image}
          alt={`${title} project thumbnail`}
          width="400"
          height="208"
          class="w-full h-52 object-cover transform group-hover:scale-105 transition-transform duration-500"
          loading={priority ? 'eager' : 'lazy'}
          decoding="async"
          fetchpriority={priority ? 'high' : undefined}
        />
      </a>
    ) : (
      <a href={`/projects/${project.id}`} class="block">
        <div class="w-full h-52 bg-gradient-to-br from-forest-green/10 via-olive-drab/10 to-dark-olive/10 flex items-center justify-center">
          <Icon name="code-bracket" size="lg" class="text-olive-drab/30" />
        </div>
      </a>
    )
  }

  <div class="p-6">
    {/* Status badges */}
    {
      (featured || status === 'in-progress') && (
        <div class="flex flex-wrap gap-2 mb-3">
          {featured && (
            <div class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-forest-green/10 text-forest-green text-xs font-medium rounded-full">
              <Icon name="star" size="2xs" />
              Featured
            </div>
          )}
          {status === 'in-progress' && (
            <div class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-olive-drab/10 text-olive-drab text-xs font-medium rounded-full">
              <Icon name="clock" size="2xs" />
              In Progress
            </div>
          )}
        </div>
      )
    }

    <a href={`/projects/${project.id}`} class="block">
      <h2
        class="text-xl font-bold text-dark-olive dark:text-off-white mb-2 group-hover:text-forest-green transition-colors duration-300"
      >
        {title}
      </h2>
      <p class="text-near-black/70 dark:text-off-white/70 mb-4 line-clamp-2 leading-relaxed">{description}</p>
    </a>

    <div class="flex items-center justify-between">
      <time datetime={pubDate.toISOString()} class="text-sm text-olive-drab/70">
        {formattedDate}
      </time>

      {
        repository && (
          <a
            href={repository}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-1.5 text-sm text-olive-drab hover:text-forest-green transition-colors"
          >
            <Icon name="github" size="xs" />
            GitHub
          </a>
        )
      }
    </div>

    {
      displayTags.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-4 pt-4 border-t border-olive-drab/10 dark:border-olive-drab/20">
          {displayTags.map((tag) => (
            <span class="text-xs font-medium px-2.5 py-1 rounded-full bg-off-white dark:bg-white/10 text-dark-olive/80 dark:text-off-white/80 border border-olive-drab/10 dark:border-olive-drab/20">
              {tag}
            </span>
          ))}
        </div>
      )
    }
  </div>

  {/* Hover arrow indicator */}
  <div
    class="absolute top-6 right-6 w-8 h-8 rounded-full bg-forest-green/10 flex items-center justify-center opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transform translate-x-2 group-hover:translate-x-0 group-focus-within:translate-x-0 transition-all duration-300"
    aria-hidden="true"
  >
    <Icon name="arrow-right" size="xs" class="text-forest-green" />
  </div>
</article>
