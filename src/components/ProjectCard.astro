---
/**
 * ProjectCard component for displaying project entries
 * Enhanced with hover effects and improved visual styling
 */
import type { CollectionEntry } from 'astro:content';
import Icon from './Icon.astro';
import { FEATURED_TAG } from '../consts';

interface Props {
  project: CollectionEntry<'projects'>;
  featured?: boolean;
  /** When true, image loads eagerly (use for above-fold LCP optimization) */
  priority?: boolean;
}

const { project, featured = false, priority = false } = Astro.props;
const { title, description, pubDate, repository, image, tags } = project.data;

const formattedDate = pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<article
  class="group relative bg-white rounded-xl border border-olive-drab/10 overflow-hidden shadow-sm hover:shadow-lg hover:shadow-forest-green/10 hover:border-forest-green/20 transform hover:-translate-y-1 transition-all duration-300"
>
  {
    image ? (
      <a href={`/projects/${project.id}`} class="block overflow-hidden">
        <img
          src={image}
          alt={`${title} project thumbnail`}
          width="400"
          height="208"
          class="w-full h-52 object-cover transform group-hover:scale-105 transition-transform duration-500"
          loading={priority ? 'eager' : 'lazy'}
          decoding="async"
          fetchpriority={priority ? 'high' : undefined}
        />
      </a>
    ) : (
      <a href={`/projects/${project.id}`} class="block">
        <div class="w-full h-52 bg-gradient-to-br from-forest-green/10 via-olive-drab/10 to-dark-olive/10 flex items-center justify-center">
          <Icon name="code-bracket" size="lg" class="text-olive-drab/30" />
        </div>
      </a>
    )
  }

  <div class="p-6">
    {/* Featured badge */}
    {
      featured && (
        <div class="inline-flex items-center gap-1.5 px-2.5 py-1 mb-3 bg-forest-green/10 text-forest-green text-xs font-medium rounded-full">
          <Icon name="star" size="xs" class="w-3.5 h-3.5" />
          Featured
        </div>
      )
    }

    <a href={`/projects/${project.id}`} class="block">
      <h2
        class="text-xl font-bold text-dark-olive mb-2 group-hover:text-forest-green transition-colors duration-300"
      >
        {title}
      </h2>
      <p class="text-near-black/70 mb-4 line-clamp-2 leading-relaxed">{description}</p>
    </a>

    <div class="flex items-center justify-between">
      <time datetime={pubDate.toISOString()} class="text-sm text-olive-drab/70">
        {formattedDate}
      </time>

      {
        repository && (
          <a
            href={repository}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-1.5 text-sm text-olive-drab hover:text-forest-green transition-colors"
          >
            <Icon name="github" size="xs" />
            GitHub
          </a>
        )
      }
    </div>

    {
      tags && tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-4 pt-4 border-t border-olive-drab/10">
          {tags
            .filter((tag) => tag !== FEATURED_TAG)
            .map((tag) => (
              <span class="text-xs font-medium px-2.5 py-1 rounded-full bg-off-white text-dark-olive/80 border border-olive-drab/10">
                {tag}
              </span>
            ))}
        </div>
      )
    }
  </div>

  {/* Hover arrow indicator */}
  <div
    class="absolute top-6 right-6 w-8 h-8 rounded-full bg-forest-green/10 flex items-center justify-center opacity-0 group-hover:opacity-100 transform translate-x-2 group-hover:translate-x-0 transition-all duration-300"
  >
    <Icon name="arrow-right" size="xs" class="text-forest-green" />
  </div>
</article>
