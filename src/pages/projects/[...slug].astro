---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Icon from '../../components/Icon.astro';
import { getCollection, render } from 'astro:content';
import { FEATURED_TAG } from '../../consts';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((project) => ({
    params: { slug: project.id },
    props: { project },
  }));
}

const { project } = Astro.props;
const { Content } = await render(project);
---

<BaseLayout title={`${project.data.title} | Bitcraft`} description={project.data.description}>
  <article class="max-w-3xl">
    <header class="mb-8">
      <a href="/projects" class="text-olive-drab hover:text-dark-olive mb-4 inline-block">
        &larr; Back to Projects
      </a>
      <h1 class="text-4xl font-bold text-dark-olive mb-4">{project.data.title}</h1>
      <p class="text-lg text-near-black mb-4">{project.data.description}</p>
      <div class="flex items-center gap-4 text-sm text-olive-drab">
        {
          project.data.status === 'in-progress' && (
            <div class="inline-flex items-center gap-1.5 px-2.5 py-1 bg-olive-drab/10 text-olive-drab text-xs font-medium rounded-full">
              <Icon name="clock" class="w-3.5 h-3.5" />
              In Progress
            </div>
          )
        }
        <time datetime={project.data.pubDate.toISOString()}>
          {
            project.data.pubDate.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
            })
          }
        </time>
        {
          project.data.repository && (
            <a
              href={project.data.repository}
              target="_blank"
              rel="noopener noreferrer"
              class="hover:text-dark-olive underline"
            >
              Repository
            </a>
          )
        }
      </div>
      {
        (() => {
          const displayTags = project.data.tags?.filter((tag) => tag !== FEATURED_TAG) ?? [];
          return displayTags.length > 0 && (
            <div class="flex flex-wrap gap-2 mt-4">
              {displayTags.map((tag) => (
                <span class="text-xs font-medium px-2.5 py-1 rounded-full bg-off-white text-dark-olive/80 border border-olive-drab/10">
                  {tag}
                </span>
              ))}
            </div>
          );
        })()
      }
    </header>
    <div class="prose prose-olive max-w-none">
      <Content />
    </div>
  </article>
</BaseLayout>
