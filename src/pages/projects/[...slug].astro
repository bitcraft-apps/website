---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ProjectHero from '../../components/ProjectHero.astro';
import ProjectNavigation from '../../components/ProjectNavigation.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  const sorted = [...projects].sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
  );

  return sorted.map((project, index) => ({
    params: { slug: project.id },
    props: {
      project,
      // Navigation follows reading order (left=back in time, right=forward in time):
      // - "Previous" (left arrow) goes to older project (next index in date-descending array)
      // - "Next" (right arrow) goes to newer project (previous index in date-descending array)
      prevProject: sorted[index + 1]
        ? { id: sorted[index + 1].id, title: sorted[index + 1].data.title }
        : null,
      nextProject: sorted[index - 1]
        ? { id: sorted[index - 1].id, title: sorted[index - 1].data.title }
        : null,
    },
  }));
}

const { project, prevProject, nextProject } = Astro.props;
const { Content } = await render(project);
---

<BaseLayout title={`${project.data.title} | Bitcraft`} description={project.data.description}>
  <ProjectHero
    slot="fullWidth"
    title={project.data.title}
    description={project.data.description}
    image={project.data.image}
    status={project.data.status}
    pubDate={project.data.pubDate}
    repository={project.data.repository}
    tags={project.data.tags}
  />

  <article class="max-w-4xl mx-auto">
    <div class="prose prose-lg max-w-none">
      <Content />
    </div>

    <ProjectNavigation prevProject={prevProject} nextProject={nextProject} />
  </article>
</BaseLayout>
