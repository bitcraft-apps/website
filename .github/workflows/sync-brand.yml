name: Sync Brand Assets

on:
  workflow_dispatch:
  repository_dispatch:
    types: [update-brand]
  schedule:
    # Run once a week on Sunday at midnight as a fallback check
    - cron: '0 0 * * 0'

permissions:
  contents: write
  pull-requests: write

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Download latest brand bundle
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Find latest release tag
          LATEST_TAG=$(gh release list --repo bitcraft-apps/bitcraft-brand --limit 1 --json tagName --jq '.[0].tagName')
          echo "Syncing from bitcraft-brand release: $LATEST_TAG"

          # Download the zip asset
          gh release download "$LATEST_TAG" \
            --repo bitcraft-apps/bitcraft-brand \
            --pattern "bitcraft-brand-bundle-*.zip" \
            --output brand-bundle.zip

      - name: Extract assets
        run: |
          # Unzip directly into public/, overwriting existing files
          unzip -o brand-bundle.zip -d public/

          # Clean up zip
          rm brand-bundle.zip

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'chore: sync brand assets from bitcraft-brand'
          branch: chore/sync-brand-assets
          delete-branch: true
          title: 'chore: update brand assets'
          body: |
            Automated sync of brand assets (favicons, tokens, OG images) from `bitcraft-apps/bitcraft-brand`.

            This PR updates the contents of `public/` with the latest brand bundle.
